---
layout: post
permalink: Web-Security-Fundamentals
---

# 普通程序员需要了解的网络攻击和基本防护

## 1. Cross Site Scripting (XSS)
XSS跨站脚本攻击，为了与CSS避免同名，所以缩写为XSS。攻击方式是利用网页开发时留下的漏洞，讲恶意脚本嵌入到用户将会访问的页面中，这样当正常用户访问该页面时，会导致之前嵌入的恶意脚本被执行，从而恶意攻击用户。

### 1.1 反射型XSS
在正常页面上，攻击者在URL中使用URLEncode相关方法对路径加密，诱惑用户访问一个加密后的URL，当用户点击该恶意URL时，恶意代码会在用户主机的浏览器上执行，获取cookie等隐私信息。步骤：

    1. 制作恶意链接例如中奖网站，对一些有需要传参的路径加入 JS 脚本代码，同时后端人员没有针对路径的参数进行转义过滤，导致这些链接出现在页面上（或邮件钓鱼）。
    2. 通过恶意链接诱导用户点击。
    3. 用户打开页面后，会触发链接中带的脚本代码，从而实行攻击。

例子：
```html
https://www.hiyd.com/dongzuo/?name=%3Cscript%3Ealert(document.cookie);%3C/script%3E
```
![](/assets/img/blogs/2021-09-16/xss0.png)

这种XSS攻击主要针对前端，并未改变网站的核心逻辑。

### 1.2 存储型XSS
这种攻击更严重一些，攻击者发现网站中存在某个漏洞，可以把 HTML 或 JS 的代码直接保存到数据库。同样后端没有对标签过滤，当response返回给前端展示时，浏览器直接解析运行这部分恶意 HTML 或 JS 代码，实行攻击。由于该部分代码是存储在数据库的，只要访问到该代码的人，都会被成为攻击的主体，从而窃取访问者的信息。步骤：

    1. 攻击者将恶意代码（HTML、JS） 提交到目标网站的数据库保存，后端人员没有对 HTML、JS 相关代码转义。
    2. 用户访问到包含从数据库中取出的恶意代码的网页；
    3. 这部分恶意代码被执行，间接盗取用户相关信息，攻击者可以冒充该用户在平台进行操作。
    
### 1.3 XSS的预防
XSS攻击的根本原理是用户输入的数据存在代码时，没有针对性进行转义和过滤，浏览器以为是正常的 HTML、JS 代码而被运行。

前端也可以对后端获取的数据做一下处理，比如对 script 标签，将特殊字符替换成 HTML 编码这些等。前端获取浏览器的参数时，要对参数过滤，目前大多数浏览器都会对从 URL 中获取的内容进行编码，这也可以阻止执行任何注入的 JavaScript 代码。后端可以对前端提交过来的数据，其中的特殊字符例如"<","'"等进行转义处理，例子：

    < 符号转义为 HTML 的 &lt;
    > 符号转义为 HTML 的 &gt;
    ' 符号转义为 HTML 的 &amp;
    " 符号转义为 HTML 的 &quot;

## 2. Cross-Site Request Forgery (CSRF,XSRF)
CSRF和XSS不同是，XSS利用站点内的信任用户进行攻击，而CSRF是通过伪装成来自受信任用户的请求来利用受信任的网站。CSRF攻击利用的是盗用身份，然后冒充盗用的身份向第三方网站发送恶意请求，CSRF能做的事情包括利用盗走的身份发邮件，发短信，进行交易转账等，甚至盗取账号。这利用 Web中用户身份验证的一个漏洞：简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。

![](/assets/img/blogs/2021-09-16/csrf0.png)

受害者只需做下面的两件事，攻击者就能够完成CSRF攻击：

    1. 登录受信任的服务器 B，在本地生成未过期的 Cookie；
    2. 在不登出站点 B 的情况下（未清空服务器 B 的 Cookie），服务器 C 窃取用户 Cookie 恶意访问服务器 B。
    
很多情况下，恶意站点可能是一个存在其他漏洞（例如XSS）的受信任并且被很多人访问的站点，这时用户可能在不知不觉中成为受害者

### 2.2 CSRF的预防

### 2.2.1 使用 Token

Token是预防CSRF的主要方法，开发者可以在HTTP header中以参数的形式加入一个随机产生的Token，在服务端校验Token，如果请求中没有Token 或者Token 不正确，那么可以认为是 CSRF 攻击，而拒绝请求。Token主要是在请求中放入攻击者无法伪造的信息，避免了攻击者进行攻击。

![](/assets/img/blogs/2021-09-16/csrf1.jpg)

### 2.2.2 将 Cookie 设置为 HttpOnly

根据前面介绍的 XSRF 的攻击原理知道，XSRF 的攻击上很大程度是利用了用户的 Cookie，为了防止站内的 XSS 漏洞被盗取 Cookie，可以在 Cookie 中设置为“HttpOnly”属性，这样别人就无法通过程序读取到该站点的 Cookie 信息，避免攻击者伪造 Cookie 的情况出现。

### 2.2.3 使用验证码

增加验证码类似于通过 Token 进行访问判断，但是这样的体验一般不是很好，所以验证码一般用于留言、评论、登录这种地方。

### 2.2.4 通过 Referer 识别

HTTP 协议中有一个 Referer 字段，它表示的是访问来源，服务器端可以根据该字段判断，判断该来源的域名是否是本地网站，如果不是的话，可以直接认为是危险链接，拒绝访问。但是如果我们把网站页面分享出去给别人，例如微信、QQ，其他人从微信朋友圈点击进来，那么该 Referer 也不是本地域名网站的。

## 3. SQL Injection

## 4. DoS/DDoS

## 构建基础防御